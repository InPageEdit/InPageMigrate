(()=>{var a={499:(a,t,e)=>{a.exports=async(a,t)=>{const i=e(559);var s=await i(a,{format:"json",action:"parse",page:t,prop:"wikitext"});return console.info("PageData",t,s),s}},612:(a,t,e)=>{a.exports=async(a,t)=>{const i=e(559);return await i(a,{format:"json",action:"parse",page:t,prop:"templates"})}},60:(a,t,e)=>{const i=e(612),s=e(850);a.exports=()=>{const a=window.InPageMigrateFrom,{wgPageName:t}=mw.config.get();var e=$("#mw-content-text"),r=$("<div>",{class:"InPageMigrate ipm-all"});r.appendTo(e);var n=$("<input>",{class:"ipm-pageName",value:t}),o=$("<button>",{class:"ipm-startBtn",text:"获取信息"}),p=$("<button>",{class:"ipm-startBtn",text:"确认迁移",disabled:!0}),c=$("<section>",{class:"ipm-detailArea",text:"操作日志"}),l=$("<ul>",{class:"ipm-progressArea"});function g(a){var t=new Date;l.prepend($("<li>").append(`[${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}] `,a))}r.append($("<h3>",{text:"快速迁移页面"}),$("<p>",{text:"您正在从 API 接口为 "+a+" 的 wiki 迁移内容。"}),$("<label>",{style:"display: block"}).append("迁移：",n," → ",$("<i>",{text:t})),$("<div>",{class:"ipm-container"}).append($("<div>",{class:"ipm-buttonArea"}).append(o,p),c.append(l))),o.click((async function(){o.attr("disabled","disabled"),p.attr("disabled","disabled"),r.data("pageList",[]),g("【等待】正在获取源页面("+n.val()+")的基础信息……");const t=await i(a,n.val());if(t.error||!t.parse)return g("【错误】遇到以下问题："+JSON.stringify(t)),void o.attr("disabled",!1).text("重试");var{parse:e}=t;r.data("pageList",[n.val()]),$.each(e.templates,((a,t)=>{var e=r.data("pageList");""===t.exists&&e.push(t["*"]),r.data("pageList",e)}));var s=r.data("pageList");g("【信息】成功获取页面信息，需要迁移以下页面："+s.join("、")+" (共计"+s.length+"个页面)"),g("【确认】请确认是否开始迁移……"),o.attr("disabled",!1),p.attr("disabled",!1)})),p.click((function(){var e=r.data("pageList");e?async function i(r){var n=e[r],o=e[r];0===r&&(o=t),g(`【信息】正在从 ${n} 迁移页面到 ${o} (${r+1}/${e.length})`),await s(a,n,o,g),r<e.length-1?i(r+1):(g("【完成】页面迁移已完成，请刷新页面后检查。"),g($("<a>",{href:mw.util.getUrl(t,{action:"purge"}),text:"立即刷新"})))}(0):g("【错误】找不到需要的页面列表，请重新获取页面信息。")}))}},559:a=>{a.exports=async(a,t={})=>!!a&&$.ajax({dataType:"jsonp",url:a,data:t})},680:a=>{a.exports=async a=>{var t=await $.get(mw.config.get("wgScriptPath")+"/api.php",{format:"json",action:"parse",prop:"",page:a});return!(t.error||!t.parse||0===t.parse.pageid)}},198:a=>{a.exports=(a,t)=>$.post(mw.config.get("wgScriptPath")+"/api.php",{format:"json",action:"edit",token:mw.user.tokens.get("editToken"),title:a,text:t,summary:"[InPageMigrate] 自动导入页面"})},850:(a,t,e)=>{const i=e(499),s=e(680),r=e(198);a.exports=async(a,t,e,n)=>{var o=$.Deferred();if(await s(e)){var p=$("<a>",{class:"ipm-existPageYes",text:"是",href:"javascript:;"}),c=$("<a>",{class:"ipm-existPageYes",text:"否",href:"javascript:;"}),l=$("<span>").append(p,"/",c);p.click((function(){l.hide(),g()})),c.click((function(){l.hide(),n("【信息】已跳过页面 "+e),o.resolve()})),n($("<span>").append("【警告】页面 <strong>"+e+"</strong> 已存在于本 wiki，是否覆盖？",l))}else g();async function g(){var s=(await i(a,t)).parse.wikitext,p=await r(e,s["*"]);(p.error||p.errors)&&(n("【错误】保存页面 "+e+"时出错。"),o.resolve()),n("【成功】已从 "+t+" 保存内容到 "+e),o.resolve()}return o}}},t={};function e(i){if(t[i])return t[i].exports;var s=t[i]={exports:{}};return a[i](s,s.exports,e),s.exports}(()=>{const a=e(60);(async()=>{await mw.loader.using(["mediawiki.api","mediawiki.util","mediawiki.user"]);const{wgArticleId:t,wgAction:e,wgRelevantPageIsProbablyEditable:i}=mw.config.get();window.InPageMigrateFrom?mw.user.isAnon()||"view"===e&&i&&0===t&&a():console.info("[InPageMigrate]","Please set API via window.InPageMigrateFrom")})()})()})();
//# sourceMappingURL=InPageMigrate.min.js.map